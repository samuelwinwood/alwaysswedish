<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Svenska med The Gang</title>
    <style>
        :root {
            --nordic-blue: #5b85aa;
            --fjord-light: #dbe9ee;
            --sage: #8da192;
            --egg-shell: #f7f7f7;
            --wood: #d8c3a5;
            --text: #2e3944;
            --success: #6b8e23;
            --error: #bc4749;
            --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--fjord-light);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #app {
            width: 100%;
            max-width: 500px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Stats Bar */
        .header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--nordic-blue);
        }

        .stat-item {
            background: rgba(255,255,255,0.6);
            padding: 8px 16px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
        }

        .progress-container {
            height: 6px;
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        #progress-fill {
            height: 100%;
            background: var(--nordic-blue);
            width: 0%;
            transition: width 1s ease;
        }

        /* Clean Card */
        .card {
            background: white;
            border-radius: 24px;
            padding: 40px 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            text-align: center;
            position: relative;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .en-translation {
            color: #888;
            font-size: 1.1rem;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .sv-sentence {
            font-size: 1.8rem;
            font-weight: 600;
            line-height: 1.6;
            margin-bottom: 40px;
        }

        .blank {
            display: inline-block;
            min-width: 100px;
            border-bottom: 2px solid #ddd;
            margin: 0 5px;
            height: 1.2em;
            vertical-align: bottom;
            color: var(--nordic-blue);
            transition: var(--transition);
            cursor: pointer;
        }
        .blank.active-blank { border-bottom: 2px solid var(--nordic-blue); background: #f0f7ff; }
        .blank.filled { border-bottom: none; font-weight: 700; color: var(--success); }

        /* Word Bank */
        .bank {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-top: auto;
        }

        .tile {
            background: #fff;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
            border: 1px solid #eee;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            cursor: pointer;
            transition: var(--transition);
        }
        .tile:active { transform: scale(0.95); background: var(--nordic-blue); color: white; }
        .tile.used { opacity: 0; pointer-events: none; transform: translateY(10px); }

        /* Primary Action */
        .btn-check {
            width: 100%;
            background: var(--nordic-blue);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 25px;
            cursor: pointer;
            transition: var(--transition);
        }
        .btn-check.correct { background: var(--success); }

        /* Celebration Overlay */
        #milestone {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--nordic-blue);
            color: white;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            text-align: center;
            padding: 40px;
        }

        .shake { animation: shake 0.4s ease; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        #feedback { font-weight: 600; margin-top: 15px; height: 20px; }
    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <div class="stat-item" id="streak">üî• 0</div>
        <div class="stat-item" id="stars">‚≠ê 0</div>
    </div>
    <div class="progress-container"><div id="progress-fill"></div></div>

    <div class="card" id="card">
        <div class="en-translation" id="en-text">Loading...</div>
        <div class="sv-sentence" id="sv-text"></div>
        <div id="feedback"></div>
        <div class="bank" id="bank"></div>
    </div>

    <button id="btn-main" class="btn-check">Kontrollera</button>
</div>

<div id="milestone">
    <h1 id="m-title">Fantastiskt!</h1>
    <p id="m-body">Du har n√•tt en ny niv√•.</p>
    <button class="btn-check" style="background:white; color:var(--nordic-blue); width:auto; padding: 15px 40px;" onclick="closeMilestone()">Forts√§tt</button>
</div>

<script>
// SCANDI-SUNNY DATABASE (Expanded to 40 phrases)
const DB = [
    // 1 Word Missing (Easy)
    {count: 1, en: "Dee is a big bird.", sv: "Dee √§r en stor __.", ans: ["f√•gel"], bank: "f√•gel|katt|hund|h√§st", hint: "Shut up, Dee!"},
    {count: 1, en: "I want a milksteak.", sv: "Jag vill ha en __.", ans: ["mj√∂lkbiff"], bank: "mj√∂lkbiff|korv|pizza|ost", hint: "Boiled over hard."},
    {count: 1, en: "Because of the implication.", sv: "P√• grund av __.", ans: ["implikationen"], bank: "implikationen|planen|id√©n|b√•ten", hint: "On the water."},
    {count: 1, en: "Danny DeVito is short.", sv: "Danny DeVito √§r __.", ans: ["kort"], bank: "kort|l√•ng|stor|bl√•", hint: "Opposite of tall."},
    {count: 1, en: "Charlie knows bird law.", sv: "Charlie kan __.", ans: ["f√•gelr√§tt"], bank: "f√•gelr√§tt|svenska|mat|bil", hint: "Legal advice."},
    {count: 1, en: "Dennis is a golden god.", sv: "Dennis √§r en __.", ans: ["guldgud"], bank: "guldgud|kung|stj√§rna|man", hint: "Five star man."},
    {count: 1, en: "I eat trash.", sv: "Jag √§ter __.", ans: ["sopor"], bank: "sopor|mat|godis|frukt", hint: "Frank's favorite."},
    {count: 1, en: "Shut up, bird!", sv: "H√•ll k√§ften, __!", ans: ["f√•gel"], bank: "f√•gel|Dee|hund|katt", hint: "Standard greeting."},
    {count: 1, en: "Wild card!", sv: "Vildkort!", sv_blank: "__!", ans: ["Vildkort"], bank: "Vildkort|Plan|Id√©|Tur", hint: "Charlie jumping out."},
    {count: 1, en: "The Nightman cometh.", sv: "Nattmannen __.", ans: ["kommer"], bank: "kommer|g√•r|sjunger|sover", hint: "Musical hit."},

    // 2 Words Missing (Unlock at 10 Stars)
    {count: 2, en: "I found a rum ham.", sv: "Jag __ en __.", ans: ["hittade", "romskinka"], bank: "hittade|romskinka|tappade|korv|s√•g", hint: "Floating in the ocean."},
    {count: 2, en: "Kitten mittens are quiet.", sv: "__ √§r __.", ans: ["Kattvantar", "tysta"], bank: "Kattvantar|tysta|Hundskor|h√∂gljudda|vantar", hint: "Is your cat too loud?"},
    {count: 2, en: "I'm a five star man.", sv: "Jag √§r en __ __.", ans: ["femstj√§rnig", "man"], bank: "femstj√§rnig|man|gyllene|gud|kung", hint: "Dennis's rating."},
    {count: 2, en: "Do you want an egg?", sv: "Vill du ha ett __?", sv_blank: "__ __ __ ett __?", ans: ["Vill", "√§gg"], bank: "Vill|√§gg|Har|√§pple|Ge|du", hint: "Trying times."},
    {count: 2, en: "Frank eats garbage.", sv: "__ √§ter __.", ans: ["Frank", "skr√§p"], bank: "Frank|skr√§p|Charlie|mat|Dee|f√•gel", hint: "Trash man."},
    {count: 2, en: "The boat is safe.", sv: "__ √§r __.", ans: ["B√•ten", "s√§ker"], bank: "B√•ten|s√§ker|Bilen|farlig|Huset", hint: "The implication."},
    {count: 2, en: "Dayman fights Nightman.", sv: "__ bek√§mpar __.", ans: ["Dagmannen", "Nattmannen"], bank: "Dagmannen|Nattmannen|Charlie|Dennis|Frank", hint: "Musical lyrics."},
    {count: 2, en: "Milksteak with jellybeans.", sv: "__ med __.", ans: ["Mj√∂lkbiff", "gel√©b√∂nor"], bank: "Mj√∂lkbiff|gel√©b√∂nor|Biff|godis|Pizza", hint: "Charlie's order."},
    {count: 2, en: "Mac is tough.", sv: "__ √§r __.", ans: ["Mac", "tuff"], bank: "Mac|tuff|Dee|svag|Dennis", hint: "Occular patdown."},
    {count: 2, en: "Rock, flag and eagle.", sv: "__, flagga och __.", ans: ["Sten", "√∂rn"], bank: "Sten|√∂rn|Papper|f√•gel|Sax|bj√∂rn", hint: "Charlie's America."},

    // 3 Words Missing (Unlock at 30 Stars)
    {count: 3, en: "He is a golden god.", sv: "__ √§r en __ __.", ans: ["Han", "gyllene", "gud"], bank: "Han|gyllene|gud|man|Hon|stj√§rna|kung", hint: "Dennis Reynolds."},
    {count: 3, en: "I am a janitor.", sv: "__ √§r en __.", sv_blank: "__ __ en __.", ans: ["Jag", "√§r", "vaktm√§stare"], bank: "Jag|√§r|vaktm√§stare|l√§rare|Du|v√§n", hint: "Charlie's job."},
    {count: 3, en: "Don't touch the ham.", sv: "__ __ __ skinkan.", ans: ["R√∂r", "inte", "romskinkan"], bank: "R√∂r|inte|romskinkan|maten|Se|√§t", hint: "Floating Frank."},
    {count: 3, en: "Where is the boat?", sv: "__ __ __?", sv_blank: "__ __ __?", ans: ["Var", "√§r", "b√•ten"], bank: "Var|√§r|b√•ten|bilen|Vem|huset", hint: "Asking directions."},
    {count: 3, en: "Birds are very loud.", sv: "__ √§r mycket __.", sv_blank: "__ __ __ __.", ans: ["F√•glar", "√§r", "h√∂gljudda"], bank: "F√•glar|√§r|h√∂gljudda|tysta|Katter|sm√•", hint: "Shut up, Dee."},
    {count: 3, en: "Give me the money.", sv: "__ __ __.", sv_blank: "__ __ __.", ans: ["Ge", "mig", "pengarna"], bank: "Ge|mig|pengarna|maten|Ta|dig", hint: "Frank at the bank."},
    {count: 3, en: "We have a plan.", sv: "__ __ en __.", ans: ["Vi", "har", "plan"], bank: "Vi|har|plan|bil|De|id√©|hus", hint: "The gang's logic."},
    {count: 3, en: "You are a jabroni.", sv: "__ √§r en __.", sv_blank: "__ __ en __.", ans: ["Du", "√§r", "jabroni"], bank: "Du|√§r|jabroni|v√§n|Han|f√•gel", hint: "Mac's cool word."},
    {count: 3, en: "I love trash.", sv: "__ __ __.", sv_blank: "__ __ __.", ans: ["Jag", "√§lskar", "skr√§p"], bank: "Jag|√§lskar|skr√§p|mat|Hon|hatar", hint: "Trash man feelings."},
    {count: 3, en: "Drink warm milk.", sv: "__ __ __.", sv_blank: "__ __ __.", ans: ["Drick", "varm", "mj√∂lk"], bank: "Drick|varm|mj√∂lk|kall|√Ñt|vatten", hint: "McPoyle style."}
];

let state = { streak: 0, stars: 0, cur: null, slots: [], activeSlot: 0 };

function init() {
    const saved = JSON.parse(localStorage.getItem('sunny_scandi') || '{}');
    state.streak = saved.s || 0; state.stars = saved.t || 0;
    setup();
    next();
}

function next() {
    let pool = [];
    if (state.stars < 10) pool = DB.filter(q => q.count === 1);
    else if (state.stars < 30) pool = DB.filter(q => q.count === 2);
    else pool = DB.filter(q => q.count === 3);

    state.cur = pool[Math.floor(Math.random() * pool.length)];
    state.slots = new Array(state.cur.count).fill(null);
    state.activeSlot = 0;

    document.getElementById('card').classList.remove('shake');
    document.getElementById('en-text').innerText = state.cur.en;
    document.getElementById('feedback').innerText = '';
    const btn = document.getElementById('btn-main');
    btn.innerText = "Kontrollera";
    btn.className = "btn-check";

    const container = document.getElementById('sv-text');
    container.innerHTML = '';
    
    // Build sentence with slots
    const parts = state.cur.sv.split('__');
    parts.forEach((part, i) => {
        container.append(part);
        if (i < state.cur.count) {
            const span = document.createElement('span');
            span.className = 'blank';
            span.id = `slot-${i}`;
            if (i === 0) span.classList.add('active-blank');
            span.onclick = () => setActiveSlot(i);
            container.append(span);
        }
    });

    const bank = document.getElementById('bank');
    bank.innerHTML = '';
    state.cur.bank.split('|').sort(() => Math.random() - 0.5).forEach(w => {
        const t = document.createElement('div');
        t.className = 'tile';
        t.innerText = w;
        t.onclick = () => place(w, t);
        bank.append(t);
    });
    updateUI();
}

function setActiveSlot(i) {
    state.activeSlot = i;
    document.querySelectorAll('.blank').forEach((b, idx) => {
        b.classList.toggle('active-blank', idx === i);
    });
    if (state.slots[i]) remove(i);
}

function place(word, tileEl) {
    if (state.slots[state.activeSlot]) remove(state.activeSlot);
    
    state.slots[state.activeSlot] = {word: word, el: tileEl};
    const slotEl = document.getElementById(`slot-${state.activeSlot}`);
    slotEl.innerText = word;
    slotEl.classList.add('filled');
    tileEl.classList.add('used');

    // Auto-advance to next empty slot
    let nextEmpty = state.slots.indexOf(null);
    if (nextEmpty !== -1) setActiveSlot(nextEmpty);
    
    speak(word);
}

function remove(i) {
    const item = state.slots[i];
    if (!item) return;
    item.el.classList.remove('used');
    state.slots[i] = null;
    const slotEl = document.getElementById(`slot-${i}`);
    slotEl.innerText = '';
    slotEl.classList.remove('filled');
    setActiveSlot(i);
}

function check() {
    if (state.slots.includes(null)) return;
    
    const userAns = state.slots.map(s => s.word.toLowerCase());
    const correctAns = state.cur.ans.map(a => a.toLowerCase());
    const isWin = JSON.stringify(userAns) === JSON.stringify(correctAns);

    if (isWin) {
        state.stars++;
        state.streak++;
        document.getElementById('feedback').innerText = "Snyggt jobbat! üåø";
        const btn = document.getElementById('btn-main');
        btn.innerText = "N√§sta ‚Üí";
        btn.className = "btn-check correct";
        
        save();
        speak(state.cur.en);

        if (state.stars % 10 === 0) showMilestone();
    } else {
        state.streak = 0;
        document.getElementById('card').classList.add('shake');
        document.getElementById('feedback').innerText = "Inte riktigt...";
        setTimeout(() => document.getElementById('card').classList.remove('shake'), 400);
    }
    updateUI();
}

function showMilestone() {
    document.getElementById('milestone').style.display = 'flex';
    document.getElementById('m-title').innerText = `Milstolpe: ${state.stars} Stj√§rnor!`;
    document.getElementById('m-body').innerText = "Du beh√§rskar verkligen Bird Law nu.";
}

function closeMilestone() {
    document.getElementById('milestone').style.display = 'none';
    next();
}

function speak(t) {
    const u = new SpeechSynthesisUtterance(t);
    u.lang = 'sv-SE'; u.rate = 0.85;
    speechSynthesis.speak(u);
}

function updateUI() {
    document.getElementById('streak').innerText = `üî• ${state.streak}`;
    document.getElementById('stars').innerText = `‚≠ê ${state.stars}`;
    document.getElementById('progress-fill').style.width = Math.min((state.stars / 50) * 100, 100) + '%';
}

function save() { localStorage.setItem('sunny_scandi', JSON.stringify({s: state.streak, t: state.stars})); }

function setup() {
    document.getElementById('btn-main').onclick = () => {
        if (document.getElementById('btn-main').classList.contains('correct')) next();
        else check();
    };
    document.getElementById('btn-hint').onclick = () => {
        document.getElementById('feedback').innerText = state.cur.hint;
    };
}

init();
</script>
</body>
</html>